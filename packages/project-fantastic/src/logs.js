(()=>{"use strict";function e(e,t,n,o,l){return{sel:e,data:t,children:n,text:o,elm:l,key:void 0===t?void 0:t.key}}const t=Array.isArray;function n(e){return"string"==typeof e||"number"==typeof e}const o={createElement:function(e){return document.createElement(e)},createElementNS:function(e,t){return document.createElementNS(e,t)},createTextNode:function(e){return document.createTextNode(e)},createComment:function(e){return document.createComment(e)},insertBefore:function(e,t,n){e.insertBefore(t,n)},removeChild:function(e,t){e.removeChild(t)},appendChild:function(e,t){e.appendChild(t)},parentNode:function(e){return e.parentNode},nextSibling:function(e){return e.nextSibling},tagName:function(e){return e.tagName},setTextContent:function(e,t){e.textContent=t},getTextContent:function(e){return e.textContent},isElement:function(e){return 1===e.nodeType},isText:function(e){return 3===e.nodeType},isComment:function(e){return 8===e.nodeType}};function l(e){return void 0===e}function s(e){return void 0!==e}const a=e("",{},[],void 0,void 0);function r(e,t){return e.key===t.key&&e.sel===t.sel}function i(e,t,n){var o;const l={};for(let s=t;s<=n;++s){const t=null===(o=e[s])||void 0===o?void 0:o.key;void 0!==t&&(l[t]=s)}return l}const u=["create","update","remove","destroy","pre","post"];function d(e,t){var n,o,l=t.elm,s=e.data.class,a=t.data.class;if((s||a)&&s!==a){for(o in a=a||{},s=s||{})s[o]&&!Object.prototype.hasOwnProperty.call(a,o)&&l.classList.remove(o);for(o in a)(n=a[o])!==s[o]&&l.classList[n?"add":"remove"](o)}}const c={create:d,update:d};function f(e,t){var n,o,l=t.elm,s=e.data.props,a=t.data.props;if((s||a)&&s!==a)for(n in s=s||{},a=a||{})o=a[n],s[n]===o||"value"===n&&l[n]===o||(l[n]=o)}const p={create:f,update:f};var v="undefined"!=typeof window&&window.requestAnimationFrame.bind(window)||setTimeout,m=!1;function h(e,t,n){var o;o=function(){e[t]=n},v((function(){v(o)}))}function y(e,t){var n,o,l=t.elm,s=e.data.style,a=t.data.style;if((s||a)&&s!==a){a=a||{};var r="delayed"in(s=s||{});for(o in s)a[o]||("-"===o[0]&&"-"===o[1]?l.style.removeProperty(o):l.style[o]="");for(o in a)if(n=a[o],"delayed"===o&&a.delayed)for(const e in a.delayed)n=a.delayed[e],r&&n===s.delayed[e]||h(l.style,e,n);else"remove"!==o&&n!==s[o]&&("-"===o[0]&&"-"===o[1]?l.style.setProperty(o,n):l.style[o]=n)}}function g(e,t){var n,o=t.elm,l=e.data.attrs,s=t.data.attrs;if((l||s)&&l!==s){for(n in l=l||{},s=s||{}){const e=s[n];l[n]!==e&&(!0===e?o.setAttribute(n,""):!1===e?o.removeAttribute(n):120!==n.charCodeAt(0)?o.setAttribute(n,e):58===n.charCodeAt(3)?o.setAttributeNS("http://www.w3.org/XML/1998/namespace",n,e):58===n.charCodeAt(5)?o.setAttributeNS("http://www.w3.org/1999/xlink",n,e):o.setAttribute(n,e))}for(n in l)n in s||o.removeAttribute(n)}}function _(e,t,n){if("function"==typeof e)e.call(t,n,t);else if("object"==typeof e)if("function"==typeof e[0])if(2===e.length)e[0].call(t,e[1],n,t);else{var o=e.slice(1);o.push(n),o.push(t),e[0].apply(t,o)}else for(var l=0;l<e.length;l++)_(e[l],t,n)}function w(e,t){var n=e.type,o=t.data.on;o&&o[n]&&_(o[n],t,e)}function b(e,t){var n,o=e.data.on,l=e.listener,s=e.elm,a=t&&t.data.on,r=t&&t.elm;if(o!==a){if(o&&l)if(a)for(n in o)a[n]||s.removeEventListener(n,l,!1);else for(n in o)s.removeEventListener(n,l,!1);if(a){var i=t.listener=e.listener||function e(t){w(t,e.vnode)};if(i.vnode=t,o)for(n in a)o[n]||r.addEventListener(n,i,!1);else for(n in a)r.addEventListener(n,i,!1)}}}function x(e,t,n){if(e.ns="http://www.w3.org/2000/svg","foreignObject"!==n&&void 0!==t)for(let e=0;e<t.length;++e){const n=t[e].data;void 0!==n&&x(n,t[e].children,t[e].sel)}}function C(o,l,s){var a,r,i,u={};if(void 0!==s?(null!==l&&(u=l),t(s)?a=s:n(s)?r=s:s&&s.sel&&(a=[s])):null!=l&&(t(l)?a=l:n(l)?r=l:l&&l.sel?a=[l]:u=l),void 0!==a)for(i=0;i<a.length;++i)n(a[i])&&(a[i]=e(void 0,void 0,void 0,a[i],void 0));return"s"!==o[0]||"v"!==o[1]||"g"!==o[2]||3!==o.length&&"."!==o[3]&&"#"!==o[3]||x(u,a,o),e(o,u,a,r,void 0)}const A=(e,t,n,o)=>C(`div.foldout fas fa-${e} fa-fw`,{class:{disabled:t},on:{click:t?()=>{}:[o,{type:"page",page:n}]}}),k=(e,t)=>C("div.controls",[A("step-backward",!e.page,0,t),A("chevron-left",!e.page,e.page-1,t),A("chevron-right",e.last_page,e.page+1,t)]),N=(e,t,n)=>C("div.checkbox",[C(`input#${t}_check`,{attrs:{type:"checkbox"},on:{click:n=>e({type:"enable_event_type",enabled:n.target.checked,event_type:t})}}),C("label",{attrs:{for:`${t}_check`}},n)]),q=(e,t)=>C("div.search",[C("div.text_search",[C("label",{attrs:{for:"username_search"}},"username"),C("input#username_search",{attrs:{type:"text"},on:{input:e=>t({type:"username_search",username:e.target.value})}})]),C("div.checkboxes",[N(t,"action","Actions"),N(t,"test","Tests"),N(t,"quest","Quests"),N(t,"command","Host Data Commands")]),C("div.button",{on:{click:[t,{type:"page",page:0}]}},"Search"),k(e,t)]),T={action:"Run Action",test:"Run Test",quest:"Run Quest",command:"Set Host Data Command"},S=(e,t)=>"action"==t.event_type?e.actions[t.action].name:"test"==t.event_type?e.tests[t.test].name:"quest"==t.event_type?e.quests[t.quest].name:"command"==t.event_type?e.commands[t.command].name:void 0,E=(e,t)=>({pass:t.every((t=>t.result==e.pass.condition)),failed:t.filter((t=>t.result!=e.pass.condition))}),$=e=>{try{const t=JSON.parse(e);return C("div.parameters",[C("div","Parameters:"),C("ul",Object.entries(t).map((e=>C("li",`${e[0]}: ${e[1]}`))))])}catch(e){return}},L=(e,t)=>{if("action"==t.event_type)return[C("div.log_details",["run"!=t.function?C("div",`Followup action: ${t.function}`):void 0,C("div",`Target node: ${t.node_id}`)]),$(t.data)];if("test"==t.event_type){const n=E(e.tests[t.test],JSON.parse(t.results));return[C("div.log_details",n.pass?"All nodes passed":`${n.failed.length} nodes failed`),$(t.parameters)]}if("quest"==t.event_type){const n=E(e.quests[t.quest],JSON.parse(t.results));return[C("div.log_details",n.pass?"All nodes passed":`${n.failed.length} nodes failed`)]}return"command"==t.event_type?[C("div.log_details",t.status?"Enabled":"Disabled")]:void 0},O=(e,t)=>C("div.logs",e.logs.map((t=>((e,t,n)=>C("div.log",[C("h3",[C("b",T[n.event_type])," ",S(e,n)]),C("div.log_details",[C("div",n.user.username),C("div",new Date(n.date).toString())]),...L(e,n)]))(e,0,t)))),j=function(d,c){let f,p;const v={create:[],update:[],remove:[],destroy:[],pre:[],post:[]},m=o;for(f=0;f<u.length;++f)for(v[u[f]]=[],p=0;p<d.length;++p){const e=d[p][u[f]];void 0!==e&&v[u[f]].push(e)}function h(t){const n=t.id?"#"+t.id:"",o=t.className?"."+t.className.split(" ").join("."):"";return e(m.tagName(t).toLowerCase()+n+o,{},[],void 0,t)}function y(e,t){return function(){if(0==--t){const t=m.parentNode(e);m.removeChild(t,e)}}}function g(e,o){var r,i;let u,d=e.data;if(void 0!==d){const t=null===(r=d.hook)||void 0===r?void 0:r.init;s(t)&&(t(e),d=e.data)}const c=e.children,f=e.sel;if("!"===f)l(e.text)&&(e.text=""),e.elm=m.createComment(e.text);else if(void 0!==f){const l=f.indexOf("#"),r=f.indexOf(".",l),p=l>0?l:f.length,h=r>0?r:f.length,y=-1!==l||-1!==r?f.slice(0,Math.min(p,h)):f,_=e.elm=s(d)&&s(u=d.ns)?m.createElementNS(u,y):m.createElement(y);for(p<h&&_.setAttribute("id",f.slice(p+1,h)),r>0&&_.setAttribute("class",f.slice(h+1).replace(/\./g," ")),u=0;u<v.create.length;++u)v.create[u](a,e);if(t(c))for(u=0;u<c.length;++u){const e=c[u];null!=e&&m.appendChild(_,g(e,o))}else n(e.text)&&m.appendChild(_,m.createTextNode(e.text));const w=e.data.hook;s(w)&&(null===(i=w.create)||void 0===i||i.call(w,a,e),w.insert&&o.push(e))}else e.elm=m.createTextNode(e.text);return e.elm}function _(e,t,n,o,l,s){for(;o<=l;++o){const l=n[o];null!=l&&m.insertBefore(e,g(l,s),t)}}function w(e){var t,n;const o=e.data;if(void 0!==o){null===(n=null===(t=null==o?void 0:o.hook)||void 0===t?void 0:t.destroy)||void 0===n||n.call(t,e);for(let t=0;t<v.destroy.length;++t)v.destroy[t](e);if(void 0!==e.children)for(let t=0;t<e.children.length;++t){const n=e.children[t];null!=n&&"string"!=typeof n&&w(n)}}}function b(e,t,n,o){for(var l,a;n<=o;++n){let o,r;const i=t[n];if(null!=i)if(s(i.sel)){w(i),o=v.remove.length+1,r=y(i.elm,o);for(let e=0;e<v.remove.length;++e)v.remove[e](i,r);const e=null===(a=null===(l=null==i?void 0:i.data)||void 0===l?void 0:l.hook)||void 0===a?void 0:a.remove;s(e)?e(i,r):r()}else m.removeChild(e,i.elm)}}function x(e,t,n){var o,a,u,d,c;const f=null===(o=t.data)||void 0===o?void 0:o.hook;null===(a=null==f?void 0:f.prepatch)||void 0===a||a.call(f,e,t);const p=t.elm=e.elm,h=e.children,y=t.children;if(e!==t){if(void 0!==t.data){for(let n=0;n<v.update.length;++n)v.update[n](e,t);null===(d=null===(u=t.data.hook)||void 0===u?void 0:u.update)||void 0===d||d.call(u,e,t)}l(t.text)?s(h)&&s(y)?h!==y&&function(e,t,n,o){let s,a,u,d,c=0,f=0,p=t.length-1,v=t[0],h=t[p],y=n.length-1,w=n[0],C=n[y];for(;c<=p&&f<=y;)null==v?v=t[++c]:null==h?h=t[--p]:null==w?w=n[++f]:null==C?C=n[--y]:r(v,w)?(x(v,w,o),v=t[++c],w=n[++f]):r(h,C)?(x(h,C,o),h=t[--p],C=n[--y]):r(v,C)?(x(v,C,o),m.insertBefore(e,v.elm,m.nextSibling(h.elm)),v=t[++c],C=n[--y]):r(h,w)?(x(h,w,o),m.insertBefore(e,h.elm,v.elm),h=t[--p],w=n[++f]):(void 0===s&&(s=i(t,c,p)),a=s[w.key],l(a)?m.insertBefore(e,g(w,o),v.elm):(u=t[a],u.sel!==w.sel?m.insertBefore(e,g(w,o),v.elm):(x(u,w,o),t[a]=void 0,m.insertBefore(e,u.elm,v.elm))),w=n[++f]);(c<=p||f<=y)&&(c>p?(d=null==n[y+1]?null:n[y+1].elm,_(e,d,n,f,y,o)):b(e,t,c,p))}(p,h,y,n):s(y)?(s(e.text)&&m.setTextContent(p,""),_(p,null,y,0,y.length-1,n)):s(h)?b(p,h,0,h.length-1):s(e.text)&&m.setTextContent(p,""):e.text!==t.text&&(s(h)&&b(p,h,0,h.length-1),m.setTextContent(p,t.text)),null===(c=null==f?void 0:f.postpatch)||void 0===c||c.call(f,e,t)}}return function(e,t){let n,o,l;const s=[];for(n=0;n<v.pre.length;++n)v.pre[n]();for(function(e){return void 0!==e.sel}(e)||(e=h(e)),r(e,t)?x(e,t,s):(o=e.elm,l=m.parentNode(o),g(t,s),null!==l&&(m.insertBefore(l,t.elm,m.nextSibling(o)),b(l,[e],0,0))),n=0;n<s.length;++n)s[n].data.hook.insert(s[n]);for(n=0;n<v.post.length;++n)v.post[n]();return t}}([c,p,{pre:function(){m=!1},create:y,update:y,destroy:function(e){var t,n,o=e.elm,l=e.data.style;if(l&&(t=l.destroy))for(n in t)o.style[n]=t[n]},remove:function(e,t){var n=e.data.style;if(n&&n.remove){var o;m||(e.elm.offsetLeft,m=!0);var l=e.elm,s=0,a=n.remove,r=0,i=[];for(o in a)i.push(o),l.style[o]=a[o];for(var u=getComputedStyle(l)["transition-property"].split(", ");s<u.length;++s)-1!==i.indexOf(u[s])&&r++;l.addEventListener("transitionend",(function(e){e.target===l&&--r,0===r&&t()}))}else t()}},{create:g,update:g},{create:b,update:b,destroy:b}]);let B={search:{event_types:{}},page:0},D=document.body;const P=e=>{B=((e,t)=>(e=((e,t)=>("actions"==t.type&&(e.actions=t.actions),"commands"==t.type&&(e.commands=t.commands),"quests"==t.type&&(e.quests=t.quests),"tests"==t.type&&(e.tests=t.tests),"perform_action"==t.type&&((e,t)=>{e.action_results[t.host]||(e.action_results[t.host]={}),e.action_results[t.host][t.action]||(e.action_results[t.host][t.action]={}),e.action_results[t.host][t.action].status="loading"})(e,t),"action_result"==t.type&&((e,t)=>{Array.isArray(t.result)&&!t.result.length&&(t.result=void 0),e.action_results[t.hostname]||(e.action_results[t.hostname]={}),e.action_results[t.hostname][t.action]||(e.action_results[t.hostname][t.action]={});const n=e.action_results[t.hostname][t.action];t.followup?n.result.find((e=>e.label===t.followup.label)).followups[t.followup.followup]=t.result.find((e=>e.label===t.followup.label)).followups[t.followup.followup]:n.result=t.result,n.foldout=!!t.result||void 0,n.status="loaded",n.date=t.date,n.filter=t.filter})(e,t),"result_foldout"==t.type&&(e.action_results[t.hostname][t.action].foldout=t.value),"action_followup"==t.type&&((e,t)=>{let n=e.action_results[t.host][t.action];for(const e of t.followups)n=n.result.find((t=>t.label===e.label)).followups[e.followup];n.status="loading",n.requests=(n.requests||0)+1})(e,t),"action_followup_result"==t.type&&((e,t)=>{Array.isArray(t.result)&&!t.result.length&&(t.result=void 0);let n=e.action_results[t.hostname][t.action];for(const e of t.followups)n=n.result.find((t=>t.label===e.label)).followups[e.followup];t.followup?t.result&&(n.result.find((e=>e.label===t.followup.label)).followups[t.followup.followup]=t.result.find((e=>e.label===t.followup.label)).followups[t.followup.followup]):n.result=t.result,n.foldout=!0,n.requests&&n.requests--,n.requests||(n.status="loaded"),n.date=t.date,n.filter=t.filter})(e,t),"followup_foldout"==t.type&&((e,t)=>{let n=e.action_results[t.hostname][t.action];for(const e of t.followups)n=n.result.find((t=>t.label===e.label)).followups[e.followup];n.foldout=t.value})(e,t),e))(e,t),"logs"==t.type&&(e.logs=t.logs),"page"==t.type&&(e.page=t.page),"last_page"==t.type&&(e.last_page=t.last_page),"enable_event_type"==t.type&&(e.search.event_types[t.event_type]=t.enabled),"username_search"==t.type&&(e.search.username=t.username),e))(B,e),D=j(D,((e,t)=>C("body",C("div#container.panel",[C("h1","Logs"),...e.actions&&e.quests&&e.tests&&e.logs?[q(e,t),O(e)]:[C("div","Loading data...")]])))(B,P)),((e,t,n)=>{var o;"init"==t.type&&(["actions","tests","quests","commands"].forEach((e=>((e,t)=>{fetch(`/${t}`).then((e=>e.json())).then((n=>e({type:t,[t]:n})))})(n,e))),n({type:"page",page:0})),"page"==t.type&&fetch(`/logs?${o={...e.search,event_types:Object.entries(e.search.event_types).filter((e=>e[1])).map((e=>e[0])),...t.page&&{page:t.page}},Object.entries(o).filter((e=>void 0!==e[1])).map((e=>{const t=Array.isArray(e[1])?`[${e[1]}]`:e[1];return`${e[0]}=${t}`})).join("&")}`).then((e=>e.json())).then((e=>{n({type:"logs",logs:e.results}),n({type:"last_page",last_page:e.is_last})}))})(B,e,P)};P({type:"init"}),window.state=B})();